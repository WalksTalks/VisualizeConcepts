<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>グループ隔離シミュレーション</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        /* --- ホイールピッカー (前回のCSS) --- */
        .picker-wrapper {
            position: relative;
            width: 300px;
            height: 150px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        .highlight-bar {
            position: absolute;
            top: 50px; left: 0; width: 100%; height: 50px;
            background-color: rgba(0, 122, 255, 0.1);
            border-top: 1px solid rgba(0, 122, 255, 0.3);
            border-bottom: 1px solid rgba(0, 122, 255, 0.3);
            pointer-events: none; z-index: 1;
        }
        .picker-list {
            list-style: none; padding: 0; margin: 0; height: 100%;
            overflow-y: scroll; scroll-snap-type: y mandatory;
            -ms-overflow-style: none; scrollbar-width: none;
            position: relative; z-index: 2;
        }
        .picker-list::-webkit-scrollbar { display: none; }
        .picker-item {
            height: 50px; display: flex; align-items: center; justify-content: center;
            font-size: 16px; font-weight: bold; color: #ccc;
            scroll-snap-align: center; transition: 0.2s; cursor: pointer;
        }
        .picker-item.active { color: #007aff; transform: scale(1.1); }
        .spacer { height: 50px; }

        /* --- グラフエリア --- */
        #myDiv {
            width: 90%;
            flex-grow: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div class="picker-wrapper">
        <div class="highlight-bar"></div>
        <ul class="picker-list" id="pickerList">
            <li class="spacer"></li>
            <li class="spacer"></li>
        </ul>
    </div>

    <div id="myDiv"></div>

    <script>
        // --- 1. データ生成ロジック (ここがポイント) ---
        // 最後の "Isolated Zone" だけ隔離します
        const categories = ["All Data", "Group A", "Group B", "Group C", "Isolated Zone"];
        const pointCount = 200; // 点の数
        const dataPoints = [];

        for(let i=0; i<pointCount; i++){
            // ランダムにグループ決定（"All Data"は除くため index 1 から）
            const groupName = categories[Math.floor(Math.random() * (categories.length - 1)) + 1];
            
            let x, y, z;

            // ★ここで座標を振り分ける
            if (groupName === "Isolated Zone") {
                // 【隔離グループ】: 座標 80〜100 の高い位置に固める
                x = Math.random() * 20 + 80;
                y = Math.random() * 20 + 20;
                z = Math.random() * 20 + 20;
            } else {
                // 【その他グループ(A,B,C)】: 座標 0〜50 の低い位置で入り乱れる
                x = Math.random() * 50;
                y = Math.random() * 50;
                z = Math.random() * 50;
            }

            dataPoints.push({ x, y, z, group: groupName });
        }

        // --- 2. グラフ初期設定 ---
        // 軸の文字・数字を消して線だけにする設定
        const axisSetting = {
            title: '',            // タイトルなし
            showticklabels: false, // 数字なし
            showgrid: true,       // グリッド線は残す（位置関係把握のため）
            zeroline: false
        };

        const trace = {
            x: dataPoints.map(d => d.x),
            y: dataPoints.map(d => d.y),
            z: dataPoints.map(d => d.z),
            mode: 'markers',
            type: 'scatter3d',
            text: dataPoints.map(d => d.group), // ツールチップ用テキスト
            hoverinfo: 'text', // 座標を出さずテキストだけ出す
            marker: {
                size: 5,
                color: '#888',
                opacity: 0.5
            }
        };

        const layout = {
            margin: { l: 0, r: 0, b: 0, t: 0 },
            scene: {
                xaxis: axisSetting,
                yaxis: axisSetting,
                zaxis: axisSetting,
                camera: { eye: {x: 1.5, y: 1.5, z: 1.5} }
            }
        };

        // 右上のメニューバーも消してスッキリさせる
        Plotly.newPlot('myDiv', [trace], layout, { displayModeBar: false });

        // --- 3. ピッカー連携 (前回と同じ) ---
        const pickerList = document.getElementById('pickerList');
        const itemHeight = 50;

        categories.forEach((cat, index) => {
            const li = document.createElement('li');
            li.className = 'picker-item';
            li.innerText = cat;
            li.onclick = () => pickerList.scrollTo({ top: index * itemHeight, behavior: 'smooth' });
            pickerList.insertBefore(li, pickerList.lastElementChild);
        });

        let timeout;
        pickerList.addEventListener('scroll', () => {
            clearTimeout(timeout);
            timeout = setTimeout(updateSelection, 50);
        });

        function updateSelection() {
            const activeIndex = Math.round(pickerList.scrollTop / itemHeight);
            
            document.querySelectorAll('.picker-item').forEach((item, idx) => {
                if (idx === activeIndex) item.classList.add('active');
                else item.classList.remove('active');
            });

            updateGraph(categories[activeIndex]);
        }

        function updateGraph(selectedCategory) {
            const highlightColor = '#FF3D00';
            const dimColor = 'rgba(150, 150, 150, 0.1)'; // 非選択は薄く

            // 色の決定ロジック
            const newColors = dataPoints.map(d => {
                if (selectedCategory === "All Data") return '#1f77b4';
                return d.group === selectedCategory ? highlightColor : dimColor;
            });

            // サイズの決定ロジック
            const newSizes = dataPoints.map(d => {
                if (selectedCategory === "All Data") return 5;
                return d.group === selectedCategory ? 10 : 3;
            });

            // 不透明度の決定ロジック
            const newOpacities = dataPoints.map(d => {
                if (selectedCategory === "All Data") return 0.6;
                return d.group === selectedCategory ? 1 : 0.1;
            });

            Plotly.restyle('myDiv', {
                'marker.color': [newColors],
                'marker.size': [newSizes],
                'marker.opacity': [newOpacities]
            });
        }

        updateSelection(); // 初期実行
    </script>
</body>
</html>